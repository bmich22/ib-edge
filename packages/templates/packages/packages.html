{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">IB Edge Tutoring Packages</h2>
  <!-- Enable site admins to add packages from front end -->
  {% if request.user.is_staff %}
    <div class="mb-4">
      <a href="{% url 'add_package' %}" class="btn btn-success">+ Add New Package</a>
    </div>
  {% endif %}
  <div class="row">
    {% for package in packages %}
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ package.name }}</h5>
            <p class="card-text">{{ package.description|truncatechars:100 }}</p>
            <ul class="list-unstyled">
              {% if package.feature1 %}<li>✔ {{ package.feature1 }}</li>{% endif %}
              {% if package.feature2 %}<li>✔ {{ package.feature2 }}</li>{% endif %}
              {% if package.feature3 %}<li>✔ {{ package.feature3 }}</li>{% endif %}
              {% if package.feature4 %}<li>✔ {{ package.feature4 }}</li>{% endif %}
              {% if package.feature5 %}<li>✔ {{ package.feature5 }}</li>{% endif %}
            </ul>
            <p class="mt-2"><strong>Ideal for:</strong> {{ package.ideal_for }}</p>
            <p><strong>Price:</strong> ${{ package.price }}</p>
            <!-- Buy Now button -->
            {% if user.is_authenticated %}
              <form method="post" action="{% url 'start_checkout' package.id %}">
                {% csrf_token %}
                <button class="btn btn-primary mt-2 w-100">Buy Now</button>
              </form>
            {% else %}
              <a href="{% url 'account_login' %}?next={% url 'start_checkout' package.id %}" class="btn btn-primary mt-2 w-100">
                Login to Buy
              </a>
              {% endif %}
            <!-- Enable site admins to edit/delete packages from front end -->
            {% if request.user.is_staff %}
              <a href="{% url 'edit_package' package.id %}" class="btn btn-warning btn-sm mt-2">Edit</a>
              <a href="{% url 'delete_package' package.id %}" class="btn btn-danger btn-sm mt-2">Delete</a>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}